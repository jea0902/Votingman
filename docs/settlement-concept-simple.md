# 정산 개념 - 아주 쉽게

## 1. 일봉 하나가 뭔가요?

**"2월 13일 일봉"** = **2월 13일 00:00** 에 시작해서 **2월 14일 00:00** 에 끝나는, 하루치 가격을 한 봉으로 만든 거예요.

```
시간 흐름 →
|---- 2월 13일 ----|---- 2월 14일 ----|
0시              24시(=다음날 0시)
↑                 ↑
시가(open)        종가(close)
= 그날 "시작" 가격  = 그날 "끝" 가격
```

- **시가(open)** = 그 봉이 **시작할 때**의 가격 → **2월 13일 00:00** 시점 가격  
- **종가(close)** = 그 봉이 **끝날 때**의 가격 → **2월 14일 00:00** 시점 가격  

그래서 **"오늘 00:00의 종가를 수집하는 이유"**는, **그 일봉이 끝나는 시점이 다음날 00:00**이기 때문이에요.  
그날 봉의 "끝 가격" = 다음날 00:00 가격 이라서, 그걸 수집하는 거예요.

---

## 2. "전날 00시 종가"랑 "오늘 00시 종가"가 왜 나와요?

봉 하나를 저장할 때 우리는 이렇게 넣어요:

| 필드 | 의미 | 실제로는 어떤 시각? |
|------|------|---------------------|
| **open** | 이 봉의 시가 | **봉이 시작한 시각** = 2월 13일 00:00 가격 |
| **close** | 이 봉의 종가 | **봉이 끝난 시각** = 2월 14일 00:00 가격 |

그런데 **2월 13일 00:00** 은  
- "2월 13일 봉의 **시가**"이면서  
- "2월 12일 봉이 **끝난 시각**"이기도 해요.  

그래서:

- **전날 00:00 종가** = 2월 13일 봉의 **시가(open)** = "비교 기준 가격" → **reference_close**
- **오늘 00:00 종가** = 2월 13일 봉의 **종가(close)** = "정산할 때 쓸 가격" → **settlement_close**

정산은 **이 두 개만 비교**하는 거예요.

---

## 3. 정산을 아기 말로 하면

1. **투표**  
   - "2월 13일 일봉"이 **오를까(롱)** **내릴까(숏)** 에 돈을 건다.

2. **두 가격만 잡기**  
   - **A** = 2월 13일 **00:00** 가격 (봉이 **시작**할 때) = DB의 **open**  
   - **B** = 2월 14일 **00:00** 가격 (봉이 **끝**날 때) = DB의 **close**

3. **비교**  
   - **B > A** → 올랐다 → **롱** 승리  
   - **B < A** → 내렸다 → **숏** 승리  
   - **B = A** → 그대로 → 전원 환불

4. **정산**  
   - 승자에게 패자 돈 나눠 주기, 패자 잔액에서 차감.

**"전날 00시 종가 vs 오늘 00시 종가"** = **"그 봉의 open vs close"** 인 이유는,  
전날 00시가 그 봉의 **시작(open)** 이고, 오늘 00시가 그 봉의 **끝(close)** 이기 때문이에요.

---

## 4. 왜 "어제 00:00 시가"를 수집하나요?

말씀하신 것처럼:

- **어제 00:00의 시가**를 수집하는 이유 = **그 전날 23:00~00:00 1시간봉의 종가**를 쓰기 위해서예요.  
  그 1시간봉 종가 = "자정(00:00) 시점 가격" = **그 일봉의 시가(open)**.

그리고:

- **오늘 00:00의 종가**를 수집하는 이유 = **그 일봉이 "끝나는 시각"이 다음날 00:00**이기 때문이에요.  
  그래서 "오늘 00:00 가격" = **그 일봉의 종가(close)** = 정산에 쓸 **settlement_close**.

정리하면:

- **시가 수집** → 전날 23:00~00:00 구간의 "끝 가격(자정 가격)" = 그 일봉의 **open**  
- **종가 수집** → 오늘 00:00 가격 = 그 일봉의 **close**  
→ 이 **open vs close** 로 정산하는 거예요.

---

## 5. 1W, 1M, 12M도 똑같아요

**봉의 "시작"과 "끝"만 정해지면**, 나머지는 일봉이랑 똑같이 생각하면 돼요.

| 봉 | 봉이 "시작"하는 시각 | 봉이 "끝"나는 시각 | 정산 비교 |
|----|----------------------|--------------------|-----------|
| **1d** | 2월 13일 00:00 KST | 2월 14일 00:00 KST | open vs close |
| **1W** | 지난주 **월요일** 00:00 KST | 이번주 **월요일** 00:00 KST | open vs close |
| **1M** | 지난달 **1일** 00:00 KST | 이번달 **1일** 00:00 KST | open vs close |
| **12M** | 전년 **1월 1일** 00:00 KST | 올해 **1월 1일** 00:00 KST | open vs close |

- **open** = 그 봉이 **시작할 때**의 가격 (= "전 봉이 끝날 때" 가격 = reference_close)  
- **close** = 그 봉이 **끝날 때**의 가격 (= settlement_close)  

**정산은 항상:**  
그 봉의 **시작 시각 가격(open)** vs **끝 시각 가격(close)** 비교 → 올랐으면 롱, 내렸으면 숏.  
일봉이든 주봉/월봉/연봉이든 **이 개념만 같다**고 보면 돼요.

---

## 6. 한 줄 요약

- **봉 하나** = "시작 시각 ~ 끝 시각" 사이의 가격을 **시가(open)·종가(close)** 로 저장.  
- **정산** = 그 봉의 **open(시작 가격)** vs **close(끝 가격)** 비교해서 롱/숏 승자 정하는 것.  
- **일봉**은 시작 = 오늘 00:00, 끝 = 내일 00:00 라서 "전날 00시 vs 오늘 00시"로 말하게 되고,  
  **1W/1M/12M**은 시작/끝만 "월요일 00:00", "1일 00:00", "1월 1일 00:00"으로 바꾼 같은 놈이라고 보면 됩니다.
