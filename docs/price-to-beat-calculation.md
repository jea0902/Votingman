# 목표가(Price to Beat) 계산 방식

투표/예측 페이지에서 표시하는 **목표가**는 **해당 봉의 시가(open)** 입니다.  
봉이 바뀌는 순간에는 “직전 봉의 종가 = 현재 봉의 시가”이므로, **목표가 = 지금 시작하는 캔들의 시가 = 바로 전 캔들의 종가**로 이해하면 됩니다.  
롱/숏 승패는 이 목표가 대비 봉 마감 시점의 **종가(close)** 가 올랐는지/내렸는지로 정산됩니다.

---

## 공통 원리

- **목표가 = 이전 봉 종가** (UP/DOWN 투표 기준선). 구현에서도 이전 봉의 `close`를 직접 조회함.
- 데이터 소스: (market, **이전 봉** candle_start_at) 행의 `close` → 없으면 Binance에서 이전 봉 1개 조회 후 `close` (이전 봉은 마감되어 안정적으로 조회 가능)

---

## 시간봉별 계산 방법

| 시장 | 봉 주기 | candle_start_at | 목표가(이전 봉 종가) |
|------|---------|-----------------|-------------------|
| **btc_15m** | 15분 | KST 00:00, 00:15, … (15분 단위) | **이전 15분 봉**의 `close` (직전 15m 캔들 종가) |
| **btc_1h** | 1시간 | KST 00:00, 01:00, … (1시간 단위) | **이전 1시간 봉**의 `close` |
| **btc_4h** | 4시간 | KST 00:00, 04:00, 08:00, 12:00, 16:00, 20:00 | **이전 4시간 봉**의 `close` |
| **btc_1d** | 1일 | KST 00:00 (당일) | **이전 일봉**의 `close` |

- **candle_start_at**은 모두 **UTC ISO**로 저장됩니다.
- 목표가 조회: 현재 봉의 **이전** candle_start_at을 구한 뒤, btc_ohlc 또는 Binance에서 그 봉의 `close` 사용.

---

## 정리

- **15분봉**: 직전 15분 봉 종가  
- **1시간봉**: 직전 1시간 봉 종가  
- **4시간봉**: 직전 4시간 봉 종가  
- **1일봉**: 직전 일봉 종가  

즉, **“지금 투표하는 그 봉이 열릴 때의 가격”**이 목표가이며, DB에 없으면 Binance에서 그 봉의 open을 실시간으로 가져와 표시합니다. 목표가가 "—"로 나오는 원인은 [price-to-beat-not-showing.md](./price-to-beat-not-showing.md) 참고.
